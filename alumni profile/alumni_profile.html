<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Alumni profile</title>
        <link rel="stylesheet" href="alumni_profile.css">
        <link rel="stylesheet" href="/home page/home_page.css">
</head>
<body>
    <div class="top-header">
    <div class="logo-title-row">
        <a href="/home page/home_page.html"><img src="/images/clg_logo.png" alt="Mepco Schlenk Engineering College Logo" class="header-logo" /></a>
    </div>
    <div class="contact">
      <label>üìû+91-4562-235104,235120</label><br><br>
      <label>‚úâÔ∏è msec@mepcoeng.ac.in</label>
    </div>
  </div>
  <nav class="navbar">
    <ul>
      <a href="../chat/chat_ui.html"><li style="position: relative; left: 10px;">MESSAGES</li></a>
      <a href="../alumni profile/alumni_profile.html"><li style="position: relative; left: 10px;">PROFILE</li></a>
      <a href="#"><li style="position: relative; left: 10px;">MEMBERS</li></a><a href="../job_posting/job-sidebar.html"><li>JOB POSTING</li></a>
      <a href="../event page/event_page.html"><li>EVENTS</li></a>
      <a href="../gallery/gallery.html"><li>GALLERY</li></a>
      <a href="#"><li>ALUMNI ASSIST</li></a>
      <a href="../fund1/fund_raising.html"><li>FUND RAISING</li></a>
      <a href="#"><li style="position: relative; left: 290px;">ABOUT US</li></a>
      <a href="../index.html"><li style="position: relative; left: 300px;">LOGOUT</li></a>
    </ul>
  </nav>    

            <div class="main-body">
                <div class="left-bar">
                    <div class="menu">
                        <label>Profile</label>
                    </div>
                    <div class="menu">
                        <label id="editProfileBtn" style="cursor:pointer;">Edit-profile</label>
                    </div>
                    <div class="menu">
                        <label id="updatePasswordBtn" style="cursor:pointer;">Update Password</label>
                    </div>
                    <div class="menu">
                        <a href="../index.html"><label>Logout</label></a>
                    </div>
                </div>
            
                <div class="body-bar">
                    <div class="body-header" id="profileView">
                        <div><label class="details-header">Name of the alumni : </label> <p class="details" id="alumni_name"></p></div><br>
                        <div><label class="details-header">Gender : </label> <p class="details" id="alumni_gender"></p></div><br>
                        <div><label class="details-header">Date of Birth : </label> <p class="details" id="alumni_dob"></p></div><br>
                        <div><label class="details-header">Alumni id : </label> <p class="details" id="alumni_id"></p></div><br>
                        <div><label class="details-header">Batch : </label> <p class="details" id="alumni_batch"></p></div><br>
                        <div><label class="details-header">Department : </label> <p class="details" id="alumni_department"></p></div><br>
                        <div><label class="details-header">Address for communication : </label> <p class="details" id="alumni_address"></p></div><br>
                        <div><label class="details-header">City : </label> <p class="details" id="alumni_city"></p></div><br>
                        <div><label class="details-header">District : </label> <p class="details" id="alumni_district"></p></div><br>
                        <div><label class="details-header">Pincode : </label> <p class="details" id="alumni_pincode"></p></div><br>
                        <div><label class="details-header">Phone number : </label> <p class="details" id="alumni_phone"></p></div><br>
                        <div><label class="details-header">Email : </label> <p class="details" id="alumni_email"></p></div><br>
                        <div><label class="details-header">Designation : </label> <p class="details" id="alumni_designation"></p></div><br>
                        <div><label class="details-header">Company : </label> <p class="details" id="alumni_company"></p></div><br>
                    </div>
                    <!-- Edit Profile Form (hidden by default) -->
                    <form id="editProfileForm" style="display:none;">
                        <h2 style="margin-bottom:18px;">Edit Profile</h2>
                        <div class="body-header">
                            <div><label class="details-header">Name of the alumni : </label> <input type="text" class="details" id="edit_name"></div><br>
                            <div><label class="details-header">Gender : </label> <input type="text" class="details" id="edit_gender"></div><br>
                            <div><label class="details-header">Date of Birth : </label> <input type="text" class="details" id="edit_dob"></div><br>
                            <div><label class="details-header">Alumni id : </label> <input class="details" type="text" id="edit_id" disabled></div><br>
                            <div><label class="details-header">Batch : </label> <input class="details" id="edit_batch" type="text"></div><br>
                            <div><label class="details-header">Department : </label> <input  class="details" type="text" id="edit_department"></div><br>
                            <div><label class="details-header">Address for communication : </label> <input  class="details" type="text" id="edit_address"></div><br>
                            <div><label class="details-header">City : </label> <input type="text" class="details" id="edit_city"></div><br>
                            <div><label class="details-header">District : </label> <input type="text" class="details" id="edit_district"></div><br>
                            <div><label class="details-header">Pincode : </label> <input type="text" class="details" id="edit_pincode"></div><br>
                            <div><label class="details-header">Phone number : </label> <input type="text" class="details" id="edit_phone"></div><br>
                            <div><label class="details-header">Email : </label> <input type="text" class="details" id="edit_email"></div><br>
                            <div><label class="details-header">Designation : </label> <input type="text" class="details" id="edit_designation"></div><br>
                            <div><label class="details-header">Company : </label> <input type="text" class="details" id="edit_company"></div><br>
                        </div>
                    </form>
                    <!-- Update Password Form (hidden by default) -->
                    <form id="updatePasswordForm" style="display:none;margin:auto;margin-top:30px;width:60%;max-width:700px;min-width:340px;border:1px solid #3498db;padding:40px 0 40px 0;background:#fff;border-radius:2px;">
                        <h2 style="text-align:center;font-family:Times New Roman,serif;font-size:2rem;margin-bottom:30px;">Change Password</h2>
                        <div style="display:flex;flex-direction:column;align-items:center;gap:24px;">
                            <div style="display:flex;align-items:center;gap:40px;">
                                <label style="font-size:1.2rem;font-family:Times New Roman,serif;width:200px;text-align:right;">Old Password</label>
                                <input type="password" id="oldPassword" name="oldPassword" style="width:250px;height:28px;font-size:1rem;" required>
                            </div>
                            <div style="display:flex;align-items:center;gap:40px;">
                                <label style="font-size:1.2rem;font-family:Times New Roman,serif;width:200px;text-align:right;">New Password</label>
                                <input type="password" id="newPassword" name="newPassword" style="width:250px;height:28px;font-size:1rem;" required>
                            </div>
                            <div style="display:flex;align-items:center;gap:40px;">
                                <label style="font-size:1.2rem;font-family:Times New Roman,serif;width:200px;text-align:right;">Confirm New Password</label>
                                <input type="password" id="confirmPassword" name="confirmPassword" style="width:250px;height:28px;font-size:1rem;" required>
                            </div>
                            <button type="submit" style="margin-top:18px;padding:6px 22px;font-size:1.1rem;font-family:Times New Roman,serif;">Change Password</button>
                            <div id="passwordMsg" style="margin-top:10px;font-size:1rem;color:#c0392b;"></div>
                        </div>
                    </form>
                    <div style="height: max-content;">
                        <img src="../images/user.png" alt="alumni image">
                    </div>
                </div>
            </div>
        </div>
        <script src="alumni_profile.js"></script>
        <script>
        // Show profile view and hide all forms when Profile is clicked
        document.querySelector('.left-bar .menu label').onclick = function() {
            document.getElementById('profileView').style.display = 'flex';
            document.getElementById('editProfileForm').style.display = 'none';
            document.getElementById('updatePasswordForm').style.display = 'none';
        };
        // Toggle edit profile form
        document.getElementById('editProfileBtn').onclick = function() {
            // Always hide password form and show only edit form
            document.getElementById('editProfileForm').style.display = 'block';
            document.getElementById('updatePasswordForm').style.display = 'none';
            document.getElementById('profileView').style.display = 'none';
            // Fill form with current values
            document.getElementById('edit_name').value = document.getElementById('alumni_name').textContent;
            document.getElementById('edit_gender').value = document.getElementById('alumni_gender').textContent;
            document.getElementById('edit_dob').value = document.getElementById('alumni_dob').textContent;
            document.getElementById('edit_batch').value = document.getElementById('alumni_batch').textContent;
            document.getElementById('edit_department').value = document.getElementById('alumni_department').textContent;
            document.getElementById('edit_address').value = document.getElementById('alumni_address').textContent;
            document.getElementById('edit_city').value = document.getElementById('alumni_city').textContent;
            document.getElementById('edit_district').value = document.getElementById('alumni_district').textContent;
            document.getElementById('edit_pincode').value = document.getElementById('alumni_pincode').textContent;
            document.getElementById('edit_phone').value = document.getElementById('alumni_phone').textContent;
            document.getElementById('edit_email').value = document.getElementById('alumni_email').textContent;
            document.getElementById('edit_designation').value = document.getElementById('alumni_designation').textContent;
            document.getElementById('edit_company').value = document.getElementById('alumni_company').textContent;
            document.getElementById('editProfileForm').style.display = 'flex';
        };
        document.getElementById('cancelEditBtn').onclick = function() {
            document.getElementById('editProfileForm').style.display = 'none';
            document.getElementById('profileView').style.display = 'flex';
            document.getElementById('editProfileMsg').textContent = '';
            document.getElementById('updatePasswordForm').style.display = 'none';
        };
        // Submit edit form
        document.getElementById('editProfileForm').onsubmit = async function(e) {
            e.preventDefault();
            const loggedInUser = sessionStorage.getItem('loggedInUser');
            const payload = {
                name: document.getElementById('edit_name').value,
                gender: document.getElementById('edit_gender').value,
                dob: document.getElementById('edit_dob').value,
                batch: document.getElementById('edit_batch').value,
                department: document.getElementById('edit_department').value,
                address: document.getElementById('edit_address').value,
                city: document.getElementById('edit_city').value,
                district: document.getElementById('edit_district').value,
                pincode: document.getElementById('edit_pincode').value,
                phone: document.getElementById('edit_phone').value,
                email: document.getElementById('edit_email').value,
                designation: document.getElementById('edit_designation').value,
                company: document.getElementById('edit_company').value
            };
            const res = await fetch('http://localhost:5000/profile/' + encodeURIComponent(loggedInUser), {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            const data = await res.json();
            if (res.ok) {
                document.getElementById('editProfileMsg').textContent = 'Profile updated!';
                // Update profile view
                for (const key in payload) {
                    const el = document.getElementById('alumni_' + key);
                    if (el) el.textContent = payload[key];
                }
                setTimeout(() => {
                    document.getElementById('editProfileForm').style.display = 'none';
                    document.getElementById('profileView').style.display = 'flex';
                    document.getElementById('editProfileMsg').textContent = '';
                }, 1200);
            } else {
                document.getElementById('editProfileMsg').textContent = data.message || 'Update failed.';
            }
        };
        // Toggle password form
        document.getElementById('updatePasswordBtn').onclick = function() {
            document.getElementById('editProfileForm').style.display = 'none';
            document.getElementById('profileView').style.display = 'none';
            document.getElementById('updatePasswordForm').style.display = 'block';
        };
        // Hide password form and return to profile after submit
        document.getElementById('updatePasswordForm').onsubmit = async function(e) {
            e.preventDefault();
            const oldPassword = document.getElementById('oldPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const msg = document.getElementById('passwordMsg');
            msg.style.color = '#c0392b';
            if (newPassword !== confirmPassword) {
                msg.textContent = 'New passwords do not match.';
                return;
            }
            if (newPassword.length < 5) {
                msg.textContent = 'Password must be at least 5 characters.';
                return;
            }
            const loggedInUser = sessionStorage.getItem('loggedInUser');
            const res = await fetch('http://localhost:5000/profile/' + encodeURIComponent(loggedInUser) + '/password', {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ oldPassword, newPassword })
            });
            const data = await res.json();
            if (res.ok) {
                msg.style.color = '#27ae60';
                msg.textContent = 'Password changed successfully!';
                setTimeout(() => {
                    document.getElementById('updatePasswordForm').style.display = 'none';
                    document.getElementById('profileView').style.display = 'flex';
                    msg.textContent = '';
                    document.getElementById('oldPassword').value = '';
                    document.getElementById('newPassword').value = '';
                    document.getElementById('confirmPassword').value = '';
                }, 1200);
            } else {
                msg.textContent = data.message || 'Password change failed.';
            }
        };
        </script>
    </body>
</html>